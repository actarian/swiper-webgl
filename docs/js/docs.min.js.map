{"version":3,"sources":["docs/js/docs.js"],"names":["glsl","containerNode","document","querySelector","swiperContainerNode","pictureNodes","querySelectorAll","pictureData","pictures","Array","prototype","slice","call","map","node","index","src","getAttribute","img","Image","onload","updateTextures","previousX","Swiper","direction","pagination","navigation","nextEl","prevEl","speed","loop","preloadImages","initialSlide","on","init","swiper","canvasNode","resize","ri","GlslCanvas","premultipliedAlpha","preserveDrawingBuffer","backgroundColor","w","offsetWidth","h","offsetHeight","style","width","height","onResize","clearTimeout","setTimeout","getCurrentIndex","x","getTranslate","diff","Math","abs","from","to","dir","previousDir","length","setUniforms","u_mix","forceRender","url","callback","data","load","request","XMLHttpRequest","open","addEventListener","responseText","send","window","onresize","event","getGlslCanvas","this","loadTexture","filtering","repeat","slideNextTransitionEnd","onTransitionEnd","slidePrevTransitionEnd","undefined","realIndex","activeIndex","forward","index1","index2","picture1","picture2","addSwiper"],"mappings":"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","file":"docs.min.js","sourcesContent":["/* global window, document, console, GlslCanvas, Swiper */\n\n(function () {\n    'use strict';\n\n    addSwiper();\n\n    function addSwiper() {\n        var containerNode = document.querySelector('.section');\n        var infoNode = containerNode.querySelector('.info > span');\n        var swiperContainerNode = containerNode.querySelector('.swiper-container');\n        var pictureNodes = swiperContainerNode.querySelectorAll('img');\n        var glsl;\n        var pictureData = [];\n        var pictures = Array.prototype.slice.call(pictureNodes, 0).map(function (node, index) {\n            var src = node.getAttribute('src');\n            var img = new Image();\n            img.onload = function () {\n                // console.log('loaded', src);\n                pictureData[index] = img;\n                if (glsl) {\n                    updateTextures(glsl.index, glsl.index);\n                }\n            };\n            img.src = src;\n            return src;\n        });\n        var swiper = new Swiper(swiperContainerNode, {\n            direction: 'horizontal',\n            pagination: false, // { el: '.swiper-pagination', }\n            navigation: {\n                nextEl: '.swiper-button-next',\n                prevEl: '.swiper-button-prev'\n            },\n            speed: 2000,\n            loop: true,\n            preloadImages: true,\n            initialSlide: 0,\n            on: {\n                init: function () {\n                    swiper = this;\n                    glsl = getGlslCanvas(swiper);\n                    glsl.loadTexture('u_tex0', 'https://raw.githubusercontent.com/actarian/swiper-webgl/master/docs/img/masks/mask-01.jpg', {\n                        filtering: 'mipmap',\n                        repeat: true,\n                    });\n                },\n                slideNextTransitionEnd: function () {\n                    swiper = this;\n                    onTransitionEnd(swiper, true);\n                },\n                slidePrevTransitionEnd: function () {\n                    swiper = this;\n                    onTransitionEnd(swiper, false);\n                },\n                /*\n                progress: function () {\n                    swiper = this;\n                    // console.log('progress', swiper.progress);\n                }\n                */\n            }\n        });\n\n        var previousX = 0,\n            previousIndex = null,\n            previousDir = null,\n            previousPow = null;\n\n        // per rimuovere il flickr serve un preload\n\n        function getGlslCanvas(swiper) {\n            var canvasNode = document.querySelector('.canvas');\n            resize(true);\n            var glsl = new GlslCanvas(canvasNode, {\n                premultipliedAlpha: false,\n                preserveDrawingBuffer: true,\n                backgroundColor: 'rgba(1,1,1,1)',\n            });\n            glsl.index = getCurrentIndex(swiper);\n            glsl.on('render', function () {\n                var x = getPow(swiper);\n                // x = Math.min(0.99, x);\n                var diff = x - previousX;\n                if (previousX !== x && Math.abs(diff) < 0.9) {\n                    previousX = x;\n                    var dir = diff > 0;\n                    // infoNode.innerText = x.toFixed(2) + ' ' + swiper.realIndex + ' ' + dir;\n                    if (previousDir !== dir) {\n                        previousDir = dir;\n                        var from, to;\n                        if (dir) {\n                            from = glsl.index;\n                            to = (glsl.index + 1) % pictures.length;\n                            updateTextures(from, to);\n                        } else {\n                            from = glsl.index;\n                            to = (glsl.index - 1) % pictures.length;\n                            to = to < 0 ? to + pictures.length : to;\n                            updateTextures(to, from);\n                        }\n                    }\n                    glsl.setUniforms({\n                        u_mix: x\n                    });\n                }\n                glsl.forceRender = true;\n            });\n\n            getResource(\"shaders/tween.glsl\", function (data) {\n                glsl.load(data);\n            });\n\n            function resize(init) {\n                var w = containerNode.offsetWidth;\n                var h = containerNode.offsetHeight;\n                canvasNode.style.width = w + 'px';\n                canvasNode.style.height = h + 'px';\n                canvasNode.width = w;\n                canvasNode.height = h;\n            }\n            var ri;\n\n            function onResize() {\n                if (ri) {\n                    clearTimeout(ri);\n                }\n                ri = setTimeout(resize, 50);\n            }\n            window.onresize = function (event) {\n                onResize();\n            };\n            onResize();\n            /*\n            for (var t in o.textures) {\n                glsl.uniformTexture('u_texture_' + t, o.textures[t], {\n                    filtering: 'mipmap',\n                    repeat: true,\n                });\n            }\n            gui.load(o.uniforms);\n            glsl.setUniforms(gui.uniforms());\n            */\n            return glsl;\n        }\n\n        function getCurrentIndex(swiper) {\n            return swiper.realIndex !== undefined ? swiper.realIndex : swiper.activeIndex;\n        }\n\n        function onTransitionEnd(swiper, forward) {\n            if (glsl) {\n                glsl.index = getCurrentIndex(swiper);\n                // console.log('onTransitionEnd', glsl.index);\n                updateTextures(glsl.index, glsl.index);\n            }\n        }\n\n        function updateTextures(index1, index2) {\n            index1 = index1 || 0;\n            // console.log('updateTextures', index1, index2);\n            if (glsl) {\n                var picture1 = pictureData[index1 % pictures.length];\n                var picture2 = pictureData[index2 % pictures.length];\n                glsl.loadTexture('u_tex1', picture1, {\n                    filtering: 'mipmap',\n                    repeat: true,\n                });\n                glsl.loadTexture('u_tex2', picture2, {\n                    filtering: 'mipmap',\n                    repeat: true,\n                });\n                // console.log('glsl.updateTextures', 'from', from, 'to', to);\n            }\n        }\n\n        /*\n        function getNextIndex(swiper, forward) {\n            var index = getCurrentIndex(swiper);\n            index = forward ? index + 1 : index - 1;\n            index = index % pictures.length;\n            if (index < 0) {\n                index = pictures.length + index;\n            }\n            console.log('getNextIndex', index);\n            return index;\n        }\n        \n        function getPreviousIndex(swiper) {\n            var index = swiper.realIndex - (swiper.activeIndex - swiper.previousIndex);\n            return index;\n        }\n        */\n\n        function getX(swiper) {\n            return (swiper.getTranslate() / containerNode.offsetWidth * -1);\n        }\n\n        function getPow(swiper) {\n            return getX(swiper) % 1.0;\n        }\n\n    }\n\n    function getResource(url, callback) {\n        var request = new XMLHttpRequest();\n        request.open('GET', url, true);\n        request.addEventListener('load', function () {\n            callback(request.responseText);\n        });\n        request.send();\n    }\n\n}());"]}