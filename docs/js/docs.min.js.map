{"version":3,"sources":["docs/js/docs.js"],"names":["Element","prototype","hasClass","name","RegExp","test","this","className","addClass","removeClass","split","join","replace","glsl","containerNode","document","querySelector","swiperContainerNode","pictureNodes","querySelectorAll","pictureData","pictures","Array","slice","call","map","node","index","src","getAttribute","img","Image","onload","updateTextures","swiper","Swiper","direction","navigation","nextEl","prevEl","pagination","el","type","clickable","speed","loop","preloadImages","initialSlide","mousewheel","on","init","canvasNode","resize","ri","GlslCanvas","premultipliedAlpha","preserveDrawingBuffer","backgroundColor","w","offsetWidth","h","offsetHeight","style","width","height","onResize","clearTimeout","setTimeout","getCurrentIndex","x","getTranslate","diff","previousX","Math","abs","from","to","dir","previousDir","length","setUniforms","u_mix","forceRender","url","callback","data","load","request","XMLHttpRequest","open","addEventListener","responseText","send","window","onresize","event","getGlslCanvas","loadTexture","filtering","repeat","setUniform","slideNextTransitionEnd","onTransitionEnd","slidePrevTransitionEnd","undefined","realIndex","activeIndex","forward","index1","index2","picture1","picture2","uniformTexture","addSwiper"],"mappings":"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","file":"docs.min.js","sourcesContent":["/* global window, document, console, GlslCanvas, Swiper */\n\n(function () {\n    'use strict';\n\n    Element.prototype.hasClass = function (name) {\n        return new RegExp(\"(?:^|\\\\s+)\" + name + \"(?:\\\\s+|$)\").test(this.className);\n    };\n\n    Element.prototype.addClass = function (name) {\n        if (!this.hasClass(name)) {\n            this.className = this.className ? (this.className + ' ' + name) : name;\n        }\n    };\n\n    Element.prototype.removeClass = function (name) {\n        if (this.hasClass(name)) {\n            this.className = this.className.split(name).join('').replace(/\\s\\s+/g, ' '); // .replace(new RegExp('(?:^|\\\\s+)' + name + '(?:\\\\s+|$)', 'g'), '');\n        }\n    };\n\n    addSwiper();\n\n    function addSwiper() {\n        var containerNode = document.querySelector('.section');\n        var infoNode = containerNode.querySelector('.info > span');\n        var swiperContainerNode = containerNode.querySelector('.swiper-container');\n        var pictureNodes = swiperContainerNode.querySelectorAll('img');\n        var glsl;\n        var pictureData = [];\n        var pictures = Array.prototype.slice.call(pictureNodes, 0).map(function (node, index) {\n            var src = node.getAttribute('src');\n            var img = new Image();\n            img.onload = function () {\n                // console.log('loaded', src);\n                pictureData[index] = img;\n                if (glsl) {\n                    updateTextures(glsl.index, glsl.index);\n                }\n            };\n            img.src = src;\n            return src;\n        });\n        var swiper = new Swiper(swiperContainerNode, {\n            direction: 'horizontal',\n            navigation: {\n                nextEl: '.swiper-button-next',\n                prevEl: '.swiper-button-prev'\n            },\n            pagination: {\n                el: '.swiper-pagination',\n                type: 'bullets',\n                clickable: true,\n            },\n            speed: 750,\n            loop: true,\n            preloadImages: true,\n            initialSlide: 0,\n            mousewheel: true,\n            on: {\n                init: function () {\n                    swiper = this;\n                    swiperContainerNode.addClass('active');\n                    glsl = getGlslCanvas(swiper);\n                    glsl.loadTexture('u_tex0', 'https://raw.githubusercontent.com/actarian/swiper-webgl/master/docs/img/masks/mask-01.jpg', {\n                        filtering: 'mipmap',\n                        repeat: true,\n                    });\n                    containerNode.addEventListener('mouseover', function () {\n                        glsl.setUniform('u_hover', true);\n                    });\n                    containerNode.addEventListener('mouseout', function () {\n                        glsl.setUniform('u_hover', false);\n                    });\n                },\n                slideNextTransitionEnd: function () {\n                    swiper = this;\n                    onTransitionEnd(swiper, true);\n                },\n                slidePrevTransitionEnd: function () {\n                    swiper = this;\n                    onTransitionEnd(swiper, false);\n                },\n                /*\n                progress: function () {\n                    swiper = this;\n                    // console.log('progress', swiper.progress);\n                }\n                */\n            }\n        });\n\n        var previousX = 0,\n            previousIndex = null,\n            previousDir = null,\n            previousPow = null;\n\n        // per rimuovere il flickr serve un preload\n\n        function getGlslCanvas(swiper) {\n            var canvasNode = document.querySelector('.canvas');\n            resize(true);\n            var glsl = new GlslCanvas(canvasNode, {\n                premultipliedAlpha: false,\n                preserveDrawingBuffer: true,\n                backgroundColor: 'rgba(1,1,1,1)',\n            });\n            glsl.index = getCurrentIndex(swiper);\n            glsl.on('render', function () {\n                var x = getPow(swiper);\n                // x = Math.min(0.99, x);\n                var diff = x - previousX;\n                if (previousX !== x && Math.abs(diff) < 0.9) {\n                    previousX = x;\n                    var dir = diff > 0;\n                    // infoNode.innerText = x.toFixed(2) + ' ' + swiper.realIndex + ' ' + dir;\n                    if (previousDir !== dir) {\n                        previousDir = dir;\n                        var from, to;\n                        if (dir) {\n                            from = glsl.index;\n                            to = (glsl.index + 1) % pictures.length;\n                            updateTextures(from, to);\n                        } else {\n                            from = glsl.index;\n                            to = (glsl.index - 1) % pictures.length;\n                            to = to < 0 ? to + pictures.length : to;\n                            updateTextures(to, from);\n                        }\n                    }\n                    glsl.setUniforms({\n                        u_mix: x\n                    });\n                }\n                glsl.forceRender = true;\n            });\n\n            getResource(\"shaders/tween.glsl\", function (data) {\n                glsl.load(data);\n            });\n\n            function resize(init) {\n                var w = containerNode.offsetWidth;\n                var h = containerNode.offsetHeight;\n                canvasNode.style.width = w + 'px';\n                canvasNode.style.height = h + 'px';\n                canvasNode.width = w;\n                canvasNode.height = h;\n            }\n            var ri;\n\n            function onResize() {\n                if (ri) {\n                    clearTimeout(ri);\n                }\n                ri = setTimeout(resize, 50);\n            }\n            window.onresize = function (event) {\n                onResize();\n            };\n            onResize();\n            /*\n            for (var t in o.textures) {\n                glsl.uniformTexture('u_texture_' + t, o.textures[t], {\n                    filtering: 'mipmap',\n                    repeat: true,\n                });\n            }\n            gui.load(o.uniforms);\n            glsl.setUniforms(gui.uniforms());\n            */\n            return glsl;\n        }\n\n        function getCurrentIndex(swiper) {\n            return swiper.realIndex !== undefined ? swiper.realIndex : swiper.activeIndex;\n        }\n\n        function onTransitionEnd(swiper, forward) {\n            if (glsl) {\n                glsl.index = getCurrentIndex(swiper);\n                // console.log('onTransitionEnd', glsl.index);\n                updateTextures(glsl.index, glsl.index);\n            }\n        }\n\n        function updateTextures(index1, index2) {\n            index1 = index1 || 0;\n            // console.log('updateTextures', index1, index2);\n            if (glsl) {\n                var picture1 = pictureData[index1 % pictures.length];\n                var picture2 = pictureData[index2 % pictures.length];\n                glsl.uniformTexture('u_tex1', picture1, {\n                    filtering: 'mipmap',\n                    repeat: true,\n                });\n                glsl.uniformTexture('u_tex2', picture2, {\n                    filtering: 'mipmap',\n                    repeat: true,\n                });\n                // console.log('glsl.updateTextures', 'from', from, 'to', to);\n            }\n        }\n\n        /*\n        function getNextIndex(swiper, forward) {\n            var index = getCurrentIndex(swiper);\n            index = forward ? index + 1 : index - 1;\n            index = index % pictures.length;\n            if (index < 0) {\n                index = pictures.length + index;\n            }\n            console.log('getNextIndex', index);\n            return index;\n        }\n        \n        function getPreviousIndex(swiper) {\n            var index = swiper.realIndex - (swiper.activeIndex - swiper.previousIndex);\n            return index;\n        }\n        */\n\n        function getX(swiper) {\n            return (swiper.getTranslate() / containerNode.offsetWidth * -1);\n        }\n\n        function getPow(swiper) {\n            return getX(swiper) % 1.0;\n        }\n\n    }\n\n    function getResource(url, callback) {\n        var request = new XMLHttpRequest();\n        request.open('GET', url, true);\n        request.addEventListener('load', function () {\n            callback(request.responseText);\n        });\n        request.send();\n    }\n\n}());"]}